<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>
    (function(w,d,s,l,i){
        w[l]=w[l]||[];
        w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-N632F7P6');
    </script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotating Cube Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }

        .container {
            text-align: center;
            padding: 20px;
        }

        nav ul {
            list-style: none;
            padding: 0;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        nav ul li {
            margin: 0 15px;
        }

        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
        }

        nav ul li a:hover {
            color: #4CAF50;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        input {
            padding: 10px;
            font-size: 16px;
            width: 200px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }

        button:hover {
            background-color: #45a049;
        }

        .cube-container {
            perspective: 1000px;
            margin-top: 50px;
            user-select: none;
        }

        .cube {
            position: relative;
            width: 200px;
            height: 200px;
            transform-style: preserve-3d;
            transition: transform 0.1s;
            cursor: grab;
            pointer-events: auto;
            margin: 0 auto;
        }

        .cube:active {
            cursor: grabbing;
        }

        .face {
            position: absolute;
            width: 200px;
            height: 200px;
            background-color: rgba(100, 149, 237, 0.8);
            border: 1px solid #fff;
            pointer-events: auto;
        }

        .front  { transform: translateZ(100px); }
        .back   { transform: translateZ(-100px) rotateY(180deg); }
        .left   { transform: translateX(-100px) rotateY(-90deg); }
        .right  { transform: translateX(100px) rotateY(90deg); }
        .top    { transform: translateY(-100px) rotateX(90deg); }
        .bottom { transform: translateY(100px) rotateX(-90deg); }

        /* 10x10 grid cells for each face */
        .mesh-cell {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            pointer-events: auto;
        }

        .mesh-cell a {
            color: #ffeb3b;
            text-decoration: none;
            display: block;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mesh-cell a:hover {
            color: #fff;
            background-color: rgba(255, 64, 129, 0.5);
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N632F7P6"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container">
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
        <h1>Display Keyword & Link on a Cube</h1>

        <!-- Input fields and button -->
        <input type="text" id="keywordInput" placeholder="Enter keyword here" />
        <input type="text" id="linkInput" placeholder="Enter link here (e.g., https://example.com)" />
        <button onclick="updateCube()">Submit</button>

        <!-- Cube Container -->
        <div class="cube-container">
            <div id="cube" class="cube">
                <div class="face front"></div>
                <div class="face back"></div>
                <div class="face left"></div>
                <div class="face right"></div>
                <div class="face top"></div>
                <div class="face bottom"></div>
            </div>
        </div>
    </div>

    <script>
    // Replace the BASE_URL with your ngrok forwarding address
    const BASE_URL = "https://d12f-2001-2d8-7381-8b9a-4cb2-2f1d-f131-9fdf.ngrok-free.app";

    const cube = document.getElementById("cube");
    let isDragging = false;
    let previousX = 0;
    let previousY = 0;
    let rotationX = 0;
    let rotationY = 0;

    // --------------------------
    // Drag Logic
    // --------------------------
    cube.addEventListener("mousedown", (e) => {
        if (e.target.className !== "mesh-cell" && e.target.tagName !== "A") {
            isDragging = true;
            previousX = e.clientX;
            previousY = e.clientY;
            e.preventDefault();
        }
    });

    document.addEventListener("mousemove", (e) => {
        if (isDragging) {
            const deltaX = e.clientX - previousX;
            const deltaY = e.clientY - previousY;
            rotationY += deltaX * 0.5;
            rotationX -= deltaY * 0.5;
            cube.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
            previousX = e.clientX;
            previousY = e.clientY;
        }
    });

    document.addEventListener("mouseup", () => { isDragging = false; });
    document.addEventListener("mouseleave", () => { isDragging = false; });

    // --------------------------
    // On Page Load: GET Cube Data
    // --------------------------
    window.onload = function() {
        fetch(`${BASE_URL}/cube/get`)
            .then(res => res.json())
            .then(data => {
                if (data && data.keyword) {
                    renderCube(data);
                }
            })
            .catch(err => console.error("Error fetching cube data:", err));
    };

    // --------------------------
    // Render the Cube
    // --------------------------
    function renderCube({ keyword, link, faceIndex, cellIndex }) {
        // Clear the selected face
        const faces = document.getElementsByClassName("face");
        const selectedFace = faces[faceIndex];
        selectedFace.innerHTML = "";

        // Generate 10x10 mesh grid
        for (let i = 0; i < 10; i++) {
            for (let j = 0; j < 10; j++) {
                const cell = document.createElement("div");
                cell.className = "mesh-cell";
                cell.style.left = `${j * 20}px`;
                cell.style.top = `${i * 20}px`;
                selectedFace.appendChild(cell);
            }
        }

        // Insert link into the specified cell
        const cells = selectedFace.getElementsByClassName("mesh-cell");
        const selectedCell = cells[cellIndex];

        const linkElement = document.createElement("a");
        linkElement.href = link;
        linkElement.textContent = keyword;
        linkElement.target = "_blank";
        linkElement.addEventListener("click", (e) => {
            console.log("Link clicked:", link);
            e.stopPropagation();
        });
        selectedCell.appendChild(linkElement);
    }

    // --------------------------
    // Submit Handler
    // --------------------------
    function updateCube() {
        const keyword = document.getElementById("keywordInput").value.trim();
        let link = document.getElementById("linkInput").value.trim();

        if (!keyword || !link) {
            alert("Please enter both a keyword and a link!");
            return;
        }

        // Ensure link has http or https
        if (!/^https?:\\/\\//i.test(link)) {
            link = "https://" + link;
        }

        // Random face & cell for demonstration
        const faceIndex = Math.floor(Math.random() * 6);   // 6 faces
        const cellIndex = Math.floor(Math.random() * 100); // 10x10 => 100 cells

        const cubeData = { keyword, link, faceIndex, cellIndex };

        // POST to the server to update
        fetch(`${BASE_URL}/cube/update`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(cubeData)
        })
        .then(response => response.json())
        .then(result => {
            if (result.status === "success") {
                // Render the updated cube data
                renderCube(result.cube_data);
            } else {
                console.error("Error updating cube:", result.error);
            }
        })
        .catch(err => console.error("Error posting updateCube request:", err));

        // Clear input fields
        document.getElementById("keywordInput").value = "";
        document.getElementById("linkInput").value = "";
    }
    </script>
</body>
</html>


